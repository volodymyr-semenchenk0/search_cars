<!DOCTYPE html>
<html lang="uk">
<meta charset="UTF-8">
<head>
    <title>Система пошуку авто</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css"
          rel="stylesheet"/>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2 class="mb-4">Система пошуку авто</h2>
    <form id="searchForm" method="POST" action="/parse" class="row g-3">

        <!-- Бренд -->
        <div class="col-md-3">
            <label for="brand" class="form-label">Марка</label>
            <select class="form-select" id="brand" name="brand">
                <option value="">Оберіть марку</option>
                {% for make in makes %}
                <option value="{{ make.make_id }}">
                    {% if request.form.get('brand') == make.make_id %} selected{% endif %} {{ make.make_display }}
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- Модель -->
        <div class="col-md-3">
            <label for="model" class="form-label">Модель</label>
            <select class="form-select" id="model" name="model" disabled>
                <option value="">Оберіть модель</option>
            </select>
        </div>

        <!-- Ціна (€) -->
        <div class="col-md-3">
            <label class="form-label">Ціна (€)</label>
            <div class="d-flex">
                <label for="pricefrom"></label>
                <select class="form-select me-2" id="pricefrom" name="pricefrom">
                    <option value="">Від</option>
                    {% for p in price_options %}
                    <option value="{{ p }}"> {% if request.form.get('pricefrom') == p|string %} selected{% endif %}
                    {{ "{:,}".format(p) }} €
                    </option>
                    {% endfor %}
                </select>
                <label for="priceto"></label>
                <select class="form-select" id="priceto" name="priceto">
                    <option value="">До</option>
                    {% for p in price_options %}
                    <option value="{{ p }}"> {% if request.form.get('priceto') == p|string %} selected{% endif %}
                    {{ "{:,}".format(p) }} €
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <!-- Рік -->
        <div class="col-md-3">
            <label class="form-label">Рік</label>
            <div class="d-flex">
                <label for="fregfrom"></label>
                <select class="form-select me-2" id="fregfrom" name="fregfrom">
                    <option value="">Від</option>
                    {% for y in years %}
                    <option value="{{ y }}"> {% if request.form.get('fregfrom') == y|string %} selected{% endif %} {{ y
                        }}
                    </option>
                    {% endfor %}
                </select>
                <label for="fregto"></label>
                <select class="form-select" id="fregto" name="fregto">
                    <option value="">До</option>
                    {% for y in years %}
                    <option value="{{ y }}"> {% if request.form.get('fregto') == y|string %} selected{% endif %} {{ y
                        }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <!-- Пробіг -->
        <div class="col-md-3">
            <label class="form-label">Пробіг (км)</label>
            <div class="d-flex">
                <label for="kmfrom"></label>
                <select class="form-select me-2" id="kmfrom" name="kmfrom">
                    <option value="">Від</option>
                    {% for m in mileage_options %}
                    <option value="{{ m }}"> {% if request.form.get('kmfrom')==m|string %} selected{% endif %}
                    {{ "{:,}".format(m) }}
                    </option>
                    {% endfor %}
                </select>

                <label for="kmto"></label>
                <select class="form-select" id="kmto" name="kmto">
                    <option value="">До</option>
                    {% for m in mileage_options %}
                    <option value="{{ m }}"> {% if request.form.get('kmto')==m|string %} selected{% endif %}
                    {{ "{:,}".format(m) }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <!-- Країна -->
        <div class="col-md-3">
            <label for="cy" class="form-label">Країна</label>
            <select class="form-select" id="cy" name="cy">
                <option value="">Усі країни</option>
                {% for name, code in country_codes.items() %}
                <option value="{{ code }}">
                    {% if request.form.get('cy') == code %} selected{% endif %} {{ name }}
                </option>
                {% endfor %}
            </select>
        </div>
        <!-- Кнопка -->
        <div class="col-md-3 align-self-end">
            <button id="searchBtn" type="submit" class="btn btn-primary w-100" disabled>Пошук на AutoScout24</button>
        </div>
    </form>

    <hr>
    <p>Кількість авто: {{ cars|length }}</p>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Марка</th>
            <th>Модель</th>
            <th>Рік</th>
            <th>Тип пального</th>
            <th>Обʼєм (л)</th>
            <th>Країна</th>
            <th>Ціна, €</th>
            <th>Мито, грн</th>
            <th>Фінальна ціна, грн</th>
            <th>Посилання</th>
        </tr>
        </thead>
        <tbody>
        {% for car in cars %}
        <tr>
            <td>{{ car.brand or '—' }}</td>
            <td>{{ car.model or '—' }}</td>
            <td>{{ car.year or '—' }}</td>
            <td>{{ engine_types.get(car.fuel_type) or car.fuel_type or '—' }}</td>
            <td>
                {% if car.engine_volume %}
                {% set volume_liters = (car.engine_volume | float) / 1000 %}
                {{ volume_liters | round(1) }}
                {% else %}
                —
                {% endif %}
            </td>
            <td>{{ country_names.get(car.country) or car.country or '—' }}</td>
            <td>{{ car.price or '—' }}</td>
            <td>{{ car.customs_uah or '—' }}</td>
            <td>{{ car.final_price_uah or '—' }}</td>
            <td>
                {% if car.link %}
                <a href="{{ car.link }}" target="_blank">Перейти</a>
                {% else %}
                —
                {% endif %}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
<script src="{{ url_for('static', filename='js/car_select.js') }}" defer></script>
</body>
</html>
