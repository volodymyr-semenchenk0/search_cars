<!DOCTYPE html>
<html lang="uk">
<meta charset="UTF-8">
<head>
    <title>Пошук автомобіля на закордонних сайтах</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css"
          rel="stylesheet"/>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body class="bg-white">
<div class="container mt-5">
    <div class="row justify-content-center g-4 text-center p-4 mb-4">
        <div class="d-flex flex-row align-items-center justify-content-center link-primary">
            <svg class="link-icon" xmlns="http://www.w3.org/2000/svg" width="17" height="16" fill="currentColor" viewBox="0 0 17 16">
                <path fill="currentColor" d="M7.022 1.489a.75.75 0 0 1 1.1 1.022L3.72 7.25H15l.076.004a.75.75 0 0 1 0 1.492L15 8.75H3.72l4.401 4.74.05.059a.75.75 0 0 1-1.094 1.014l-.055-.053-5.572-6a.751.751 0 0 1 0-1.021l5.572-6Z"/>
            </svg>
            <a href="{{ url_for('index') }}">Повернутись до списку</a>
        </div>
        <h2 class="mb-4">Форма для пошуку авто на закордонних сайтах</h2>
    </div>

    <hr/>
    {% include "loader.html" %}
    <form id="searchForm" method="POST" action="{{ url_for('parse_query') }}" class="row g-3">

        <!-- Бренд -->
        <div class="col-md-3">
            <label for="make" class="form-label">Марка</label>
            <select class="form-select" id="make" name="make">
                <option value="">Оберіть марку</option>
                {% for make in makes %}
                <option value="{{ make.make_id }}" {% if selected.brand==make.make_id %}selected{% endif %}>
                    {{ make.make_display }}
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- Модель -->
        <div class="col-md-3">
            <label for="model" class="form-label">Модель</label>
            <select class="form-select" id="model" name="model" disabled>
                <option value="">Оберіть модель</option>
            </select>
        </div>

        <!-- Ціна (€) -->
        <div class="col-md-3">
            <label class="form-label">Ціна (€)</label>
            <div class="d-flex">
                <label for="pricefrom"></label>
                <select class="form-select me-2" id="pricefrom" name="pricefrom">
                    <option value="">Від</option>
                    {% for p in price_options %}
                    <option value="{{ p }}" {% if selected.pricefrom==p|string %}selected{% endif %}>
                        {{ "{:,}".format(p) }} €
                    </option>
                    {% endfor %}
                </select>
                <label for="priceto"></label>
                <select class="form-select" id="priceto" name="priceto">
                    <option value="">До</option>
                    {% for p in price_options %}
                    <option value="{{ p }}" {% if selected.priceto==p %}selected{% endif %}>
                        {{ "{:,}".format(p) }} €
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <!-- Рік -->
        <div class="col-md-3">
            <label class="form-label">Рік</label>
            <div class="d-flex">
                <label for="fregfrom"></label>
                <select class="form-select me-2" id="fregfrom" name="fregfrom">
                    <option value="">Від</option>
                    {% for y in years %}
                    <option value="{{ y }}" {% if selected.fregfrom==y %}selected{% endif %}>
                        {{ y }}
                    </option>
                    {% endfor %}
                </select>
                <label for="fregto"></label>
                <select class="form-select" id="fregto" name="fregto">
                    <option value="">До</option>
                    {% for y in years %}
                    <option value="{{ y }}" {% if selected.fregto==y %}selected{% endif %}>
                    {{ y }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <!-- Пробіг -->
        <div class="col-md-3">
            <label class="form-label">Пробіг (км)</label>
            <div class="d-flex">
                <label for="kmfrom"></label>
                <select class="form-select me-2" id="kmfrom" name="kmfrom">
                    <option value="">Від</option>
                    {% for m in mileage_options %}
                    <option value="{{ m }}" {% if selected.kmfrom==m %}selected{% endif %}>
                        {{ "{:,}".format(m) }}
                    </option>
                    {% endfor %}
                </select>

                <label for="kmto"></label>
                <select class="form-select" id="kmto" name="kmto">
                    <option value="">До</option>
                    {% for m in mileage_options %}
                    <option value="{{ m }}" {% if selected.kmto==m %}selected{% endif %}>
                        {{ "{:,}".format(m) }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <!-- Країна -->
        <div class="col-md-3">
            <label for="cy" class="form-label">Країна</label>
            <select class="form-select" id="cy" name="cy">
                <option value="">Усі країни</option>
                {% for name, code in country_codes.items() %}
                <option value="{{ code }}" {% if selected.cy==code %}selected{% endif %}>
                    {{ name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-3">
            <label for="fuel" class="form-label">Тип пального</label>
            <select id="fuel" name="fuel" class="form-select">
                <option value="">Усі типи</option>
                {% for key, obj in fuel_types.items() %}
                <option value="{{ obj.code }}" {% if selected.fuel==obj.code %}selected{% endif %}>
                    {{ obj.label }}
                </option>
                {% endfor %}
            </select>
        </div>

        <!--<div class="col-mpt-4">
            <input class="form-check-input" type="checkbox" id="autoRefreshToggle">
            <label class="form-check-label" for="autoRefreshToggle">
                Автоматичне оновлення результатів
            </label>
        </div>-->

        <!-- Кнопка -->
        <div class="col-md-3 align-self-end">
            <button id="searchBtn" type="submit" class="btn btn-primary w-100">Пошук на AutoScout24</button>
        </div>
    </form>
    <hr/>
<!--    <p>Знайдено авто: {{ cars|length }}</p>-->
</div>
<script src="{{ url_for('static', filename='js/car_select.js') }}" defer></script>
<!--<script>
  let refreshInterval = null;

  $(document).ready(function() {
    const autoRefresh = localStorage.getItem('autoRefresh') === 'true';
    $('#autoRefreshToggle').prop('checked', autoRefresh);
    if (autoRefresh) startAutoRefresh();

    $('#autoRefreshToggle').on('change', function() {
      const enabled = $(this).is(':checked');
      localStorage.setItem('autoRefresh', enabled);
      if (enabled) {
        startAutoRefresh();
      } else {
        stopAutoRefresh();
      }
    });
  });

  function startAutoRefresh() {
    stopAutoRefresh();
    refreshInterval = setInterval(() => {
      $('#searchForm').submit();
    }, 300000); // 5 хв
  }

  function stopAutoRefresh() {
    if (refreshInterval) {
      clearInterval(refreshInterval);
      refreshInterval = null;
    }
  }
</script>-->
</body>
</html>
